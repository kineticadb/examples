{
  "workbook": {
    "metadata": {},
    "config": {},
    "id": "e50b5e70-8f2a-11ee-8c36-d1af09c7db0b",
    "name": "Materialized Views in Kinetica",
    "description": "Description for Materialized views in Kinetica",
    "user_id": "46523970-0f78-11ee-923c-8fcc28f78a58",
    "warehouse_id": null,
    "is_example": false,
    "is_shared": false,
    "created_at": "2023-03-21T19:01:23.884Z",
    "updated_at": "2023-11-30T02:49:18.573Z",
    "userId": "46523970-0f78-11ee-923c-8fcc28f78a58"
  },
  "worksheets": [
    {
      "config": {},
      "id": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
      "name": "1. Data setup (DDL)",
      "description": "Description for sheet 6",
      "previous_worksheet_id": null,
      "next_worksheet_id": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
      "workbook_id": "e50b5e70-8f2a-11ee-8c36-d1af09c7db0b",
      "created_at": "2023-03-21T19:02:52.147Z",
      "updated_at": "2023-11-30T02:48:09.589Z",
      "workbookId": "e50b5e70-8f2a-11ee-8c36-d1af09c7db0b"
    },
    {
      "config": {},
      "id": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
      "name": "Materialized views",
      "description": "Description for sheet 2",
      "previous_worksheet_id": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
      "next_worksheet_id": null,
      "workbook_id": "e50b5e70-8f2a-11ee-8c36-d1af09c7db0b",
      "created_at": "2023-03-21T19:03:28.349Z",
      "updated_at": "2023-11-30T02:48:09.603Z",
      "workbookId": "e50b5e70-8f2a-11ee-8c36-d1af09c7db0b"
    }
  ],
  "blockMap": {
    "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b": [
      {
        "config": {},
        "id": "e51597a0-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block",
        "description": "Description for Block",
        "content": "[{\"type\":\"paragraph\",\"children\":[{\"text\":\"SETUP THE DATA SOURCE\",\"bold\":true}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"The SQL statements below create a credential and then use that to connect to the Kafka topic that is streaming ship locations.\"}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"ABOUT THE DATA\",\"bold\":true}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"The Kafka streams is setup to simulate a real time stream of ship locations over the last 2 days.\"}]}]",
        "previous_block_id": null,
        "next_block_id": "e51bb220-8f2a-11ee-8c36-d1af09c7db0b",
        "block_type_id": "a9949a1a-14e3-11eb-adc1-0242ac120002",
        "worksheet_id": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:02:52.399Z",
        "updated_at": "2023-11-30T02:48:09.243Z",
        "worksheetId": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "a9949a1a-14e3-11eb-adc1-0242ac120002"
      },
      {
        "config": {},
        "id": "e51bb220-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block",
        "description": "Description for Block",
        "content": "\"-- Drop the table into which we will be streaming (if it exists) so that we can recreate the credential\\nDROP TABLE IF EXISTS ship_tracks;\\n\\n-- Create the credentials for the kafka cluster\\nCREATE OR REPLACE CREDENTIAL ship_confluent_creds\\nTYPE = 'kafka',\\nIDENTITY = '' ,\\nSECRET = ''\\nWITH OPTIONS (  \\n   'security.protocol' = 'SASL_SSL',\\n   'sasl.mechanism' = 'PLAIN',\\n   'sasl.username' = 'QZN62QB2RBTLW74L',\\n   'sasl.password' = 'iiJDdKeBzf5ms5EInLvpRslW1zwsTYx9tjZ1pQyVoS+gPGkyNms6eMXPaR6y+GST'\\n);\\n\\n-- Create the data source\\nCREATE OR REPLACE DATA SOURCE ships_stream_source\\nLOCATION = 'kafka://pkc-ep9mm.us-east-2.aws.confluent.cloud:9092'\\nWITH OPTIONS \\n(\\n    kafka_topic_name =  'ais_tracks',\\n    credential = 'ship_confluent_creds'\\n);\\n\"",
        "previous_block_id": "e51597a0-8f2a-11ee-8c36-d1af09c7db0b",
        "next_block_id": "e52f3a20-8f2a-11ee-8c36-d1af09c7db0b",
        "block_type_id": "84b9233c-14e3-11eb-adc1-0242ac120002",
        "worksheet_id": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:02:52.522Z",
        "updated_at": "2023-11-30T02:48:09.259Z",
        "worksheetId": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "84b9233c-14e3-11eb-adc1-0242ac120002"
      },
      {
        "config": {},
        "id": "e52f3a20-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block",
        "description": "Description for Block",
        "content": "[{\"type\":\"paragraph\",\"children\":[{\"text\":\"LOAD THE DATA\",\"bold\":true}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"Next we define the table and start loading data from the kafka cluster. Kinetica starts by loading the first message in the topic (about 2 days old) till it catches up with the most recent message (i.e. the current location of ships).\"}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"The map below is set to refresh automatically once every 2 seconds, so you can see the tracks develop on the map as the data streams in.\"}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"⚠️ \"},{\"text\":\"NOTE: \",\"bold\":true},{\"text\":\"The data for the Kafka topic is generated using a seed file that contains about 4 days worth of Track data. So you might start seeing Tracks that are repeated if you keep Kinetica running for more than that period. This might yield unexpected results when analyzing Tracks.\"}]}]",
        "previous_block_id": "e51bb220-8f2a-11ee-8c36-d1af09c7db0b",
        "next_block_id": "e533f510-8f2a-11ee-8c36-d1af09c7db0b",
        "block_type_id": "a9949a1a-14e3-11eb-adc1-0242ac120002",
        "worksheet_id": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:02:52.777Z",
        "updated_at": "2023-11-30T02:48:09.275Z",
        "worksheetId": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "a9949a1a-14e3-11eb-adc1-0242ac120002"
      },
      {
        "config": {},
        "id": "e533f510-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block 1",
        "description": "Description for Block 1",
        "content": "\"-- Create the table for the ais data\\nCREATE OR REPLACE TABLE ship_tracks\\n(\\n    \\\"TIMESTAMP\\\" TIMESTAMP NOT NULL,\\n    \\\"CONTINENT\\\" VARCHAR (64, dict),\\n    \\\"COUNTRY\\\" VARCHAR (32, dict),\\n    \\\"TRACKID\\\" VARCHAR (shard_key, 64),\\n    \\\"NAVIGATION_STATUS\\\" VARCHAR (64, dict),\\n    \\\"y\\\" REAL,\\n    \\\"x\\\" REAL,\\n    \\\"SHIP_TYPE\\\" VARCHAR (64, dict)\\n);\\n\\n-- Load the data from the kafka data source into the table\\nLOAD DATA INTO ship_tracks\\nFORMAT JSON \\nWITH OPTIONS (\\n    DATA SOURCE = 'ships_stream_source',\\n    SUBSCRIBE = TRUE,\\n    TYPE_INFERENCE_MODE = 'speed',\\n    ERROR_HANDLING = 'permissive',\\n    kafka_subscription_cancel_after = 120 -- cancels the stream after 120 minutes\\n);\"",
        "previous_block_id": "e52f3a20-8f2a-11ee-8c36-d1af09c7db0b",
        "next_block_id": "e538fe20-8f2a-11ee-8c36-d1af09c7db0b",
        "block_type_id": "84b9233c-14e3-11eb-adc1-0242ac120002",
        "worksheet_id": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:02:53.032Z",
        "updated_at": "2023-11-30T02:48:09.290Z",
        "worksheetId": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "84b9233c-14e3-11eb-adc1-0242ac120002"
      },
      {
        "config": {},
        "id": "e538fe20-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block",
        "description": "Description for Block",
        "content": "[{\"table_schema\":\"\",\"table_name\":\"ship_tracks\",\"geometry_type\":\"lon_lat\",\"longitude\":\"x\",\"latitude\":\"y\",\"renderType\":\"track\",\"trackHeadColor\":\"ca2c92\",\"trackHeadShape\":\"hollowdiamond\",\"trackHeadSize\":3,\"trackMarkerColor\":\"ca2c92\",\"trackMarkerShape\":\"none\",\"trackMarkerSize\":2,\"trackLineColor\":\"3700b3\",\"trackLineWidth\":1,\"symbolRotation\":\"\",\"center_longitude\":-88.9805,\"center_latitude\":23.6344,\"zoom_level\":4.974264877307863,\"opacity\":70,\"overrides\":\"\",\"auto_refresh_interval\":2,\"basemap_style\":\"grayscale\"}]",
        "previous_block_id": "e533f510-8f2a-11ee-8c36-d1af09c7db0b",
        "next_block_id": null,
        "block_type_id": "e8ccc4e2-793f-47ed-9af2-f0a58a840006",
        "worksheet_id": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:02:53.289Z",
        "updated_at": "2023-11-30T02:48:09.306Z",
        "worksheetId": "e50fcb40-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "e8ccc4e2-793f-47ed-9af2-f0a58a840006"
      }
    ],
    "e548dca0-8f2a-11ee-8c36-d1af09c7db0b": [
      {
        "config": {},
        "id": "e54cfb50-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block 1",
        "description": "Description for Block 1",
        "content": "\"CREATE OR REPLACE MATERIALIZED VIEW track_lengths\\nREFRESH ON CHANGE AS\\nSELECT \\n    TRACKID, \\n    ROUND(ST_TRACKLENGTH(Y, X,TIMESTAMP, 1) / 1000) AS track_length_km\\nFROM ship_tracks\\nGROUP BY TRACKID;\"",
        "previous_block_id": "e55c64a0-8f2a-11ee-8c36-d1af09c7db0b",
        "next_block_id": "e56209f0-8f2a-11ee-8c36-d1af09c7db0b",
        "block_type_id": "84b9233c-14e3-11eb-adc1-0242ac120002",
        "worksheet_id": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:03:28.657Z",
        "updated_at": "2023-11-30T02:48:09.513Z",
        "worksheetId": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "84b9233c-14e3-11eb-adc1-0242ac120002"
      },
      {
        "config": {},
        "id": "e5525280-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block",
        "description": "Description for Block",
        "content": "\"CREATE OR REPLACE MATERIALIZED VIEW track_render_data \\nREFRESH ON CHANGE AS \\nSELECT TRACKID, x, y, TIMESTAMP \\nFROM ship_tracks\\nWHERE TRACKID IN (SELECT TRACKID FROM track_lengths ORDER BY track_length_km DESC LIMIT 5)\"",
        "previous_block_id": "e56209f0-8f2a-11ee-8c36-d1af09c7db0b",
        "next_block_id": "e5573480-8f2a-11ee-8c36-d1af09c7db0b",
        "block_type_id": "84b9233c-14e3-11eb-adc1-0242ac120002",
        "worksheet_id": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:04:21.380Z",
        "updated_at": "2023-11-30T02:48:09.528Z",
        "worksheetId": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "84b9233c-14e3-11eb-adc1-0242ac120002"
      },
      {
        "config": {},
        "id": "e5573480-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block",
        "description": "Description for Block",
        "content": "[{\"table_schema\":\"\",\"table_name\":\"track_render_data\",\"geometry_type\":\"lon_lat\",\"longitude\":\"x\",\"latitude\":\"y\",\"renderType\":\"track\",\"trackHeadColor\":\"ca2c92\",\"trackHeadShape\":\"hollowdiamond\",\"trackHeadSize\":8,\"trackMarkerColor\":\"2cc1caff\",\"trackMarkerShape\":\"none\",\"trackMarkerSize\":1,\"trackLineColor\":\"3700b3\",\"trackLineWidth\":3,\"symbolRotation\":\"\",\"center_longitude\":-94.1652,\"center_latitude\":25.8273,\"zoom_level\":6.16,\"opacity\":70,\"overrides\":\"\",\"auto_refresh_interval\":5,\"basemap_style\":\"grayscale\"}]",
        "previous_block_id": "e5525280-8f2a-11ee-8c36-d1af09c7db0b",
        "next_block_id": null,
        "block_type_id": "e8ccc4e2-793f-47ed-9af2-f0a58a840006",
        "worksheet_id": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:05:40.571Z",
        "updated_at": "2023-11-30T02:48:09.544Z",
        "worksheetId": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "e8ccc4e2-793f-47ed-9af2-f0a58a840006"
      },
      {
        "config": {},
        "id": "e55c64a0-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block",
        "description": "Description for Block",
        "content": "[{\"type\":\"paragraph\",\"children\":[{\"text\":\"CALCULATE TRACK LENGTHS\",\"bold\":true}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"The ST_TRACKLENGTH calculates the length of tracks in meters. The view is set to refresh on change.\"}]}]",
        "previous_block_id": null,
        "next_block_id": "e54cfb50-8f2a-11ee-8c36-d1af09c7db0b",
        "block_type_id": "a9949a1a-14e3-11eb-adc1-0242ac120002",
        "worksheet_id": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:51:31.696Z",
        "updated_at": "2023-11-30T02:48:09.559Z",
        "worksheetId": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "a9949a1a-14e3-11eb-adc1-0242ac120002"
      },
      {
        "config": {},
        "id": "e56209f0-8f2a-11ee-8c36-d1af09c7db0b",
        "name": "Block",
        "description": "Description for Block",
        "content": "[{\"type\":\"paragraph\",\"children\":[{\"text\":\"IDENTIFY LONGEST TRACKS\",\"bold\":true}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"The query below filters tracks for the longest tracks in the track_lengths view. This query is also set to refresh on change.\"}]}]",
        "previous_block_id": "e54cfb50-8f2a-11ee-8c36-d1af09c7db0b",
        "next_block_id": "e5525280-8f2a-11ee-8c36-d1af09c7db0b",
        "block_type_id": "a9949a1a-14e3-11eb-adc1-0242ac120002",
        "worksheet_id": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "created_at": "2023-03-21T19:52:21.390Z",
        "updated_at": "2023-11-30T02:48:09.573Z",
        "worksheetId": "e548dca0-8f2a-11ee-8c36-d1af09c7db0b",
        "blockTypeId": "a9949a1a-14e3-11eb-adc1-0242ac120002"
      }
    ]
  },
  "vizMap": {
    "e51597a0-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e51bb220-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e52f3a20-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e533f510-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e538fe20-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e54cfb50-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e5525280-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e5573480-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e55c64a0-8f2a-11ee-8c36-d1af09c7db0b": [],
    "e56209f0-8f2a-11ee-8c36-d1af09c7db0b": []
  }
}